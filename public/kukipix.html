<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kukipix - Devine l'image !</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

#app {
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  max-width: 800px;
  width: 100%;
  overflow: hidden;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
}

.header h1 {
  font-size: 2.5rem;
  margin-bottom: 10px;
}

.game-area {
  padding: 30px;
}

.image-container {
  background: #f5f5f5;
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 300px;
}

#gameImage {
  max-width: 100%;
  max-height: 400px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  image-rendering: pixelated;
  transition: all 0.5s ease;
}

.image-info {
  text-align: center;
  color: #666;
  font-size: 0.9rem;
  margin-top: 10px;
}

.answer-area {
  margin-bottom: 30px;
}

.answer-input {
  display: flex;
  gap: 10px;
}

input[type="text"] {
  flex: 1;
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 1rem;
  transition: border 0.3s;
}

input[type="text"]:focus {
  outline: none;
  border-color: #667eea;
}

button {
  padding: 15px 30px;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

button:active {
  transform: translateY(0);
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-success {
  background: #10b981;
  color: white;
}

.players-area {
  background: #f9f9f9;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
}

.players-area h3 {
  margin-bottom: 15px;
  color: #333;
}

.player-item {
  background: white;
  padding: 10px 15px;
  margin-bottom: 8px;
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.player-name {
  font-weight: bold;
  color: #667eea;
}

.player-points {
  color: #10b981;
  font-weight: bold;
}

.player-found {
  color: #10b981;
  font-size: 1.2rem;
}

.chat-area {
  background: #f9f9f9;
  border-radius: 10px;
  padding: 20px;
  max-height: 200px;
  overflow-y: auto;
}

.chat-message {
  padding: 8px 0;
  color: #555;
  font-size: 0.9rem;
  border-bottom: 1px solid #e0e0e0;
}

.chat-message:last-child {
  border-bottom: none;
}

.waiting-screen {
  text-align: center;
  padding: 60px 20px;
}

.waiting-screen h2 {
  color: #667eea;
  margin-bottom: 30px;
}

.hidden {
  display: none !important;
}

.timer {
  text-align: center;
  font-size: 1.5rem;
  color: #667eea;
  font-weight: bold;
  margin-bottom: 20px;
}

.resultat {
  text-align: center;
  padding: 40px;
}

.resultat h2 {
  color: #10b981;
  margin-bottom: 20px;
}

.podium {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 30px 0;
}

.podium-item {
  background: white;
  padding: 15px;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.podium-item.first {
  background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
  font-size: 1.2rem;
}

.podium-item.second {
  background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
}

.podium-item.third {
  background: linear-gradient(135deg, #cd7f32 0%, #daa520 100%);
}
</style>
</head>
<body>
<div id="app">
  <div class="header">
    <h1>üé® Kukipix</h1>
    <p>Devine l'image qui se r√©v√®le progressivement !</p>
  </div>

  <div class="game-area">
    <!-- √âcran d'attente -->
    <div id="waitingScreen" class="waiting-screen">
      <h2>En attente de joueurs...</h2>
      <button class="btn-primary" onclick="demarrerPartie()">üéÆ D√©marrer la partie</button>
    </div>

    <!-- √âcran de jeu -->
    <div id="gameScreen" class="hidden">
      <div class="timer" id="timer">00:00</div>
      
      <div class="image-container">
        <img id="gameImage" src="" alt="Image myst√®re" />
      </div>
      <div class="image-info" id="imageInfo">Image pixelis√©e (18px)</div>

      <div class="answer-area">
        <div class="answer-input">
          <input 
            type="text" 
            id="answerInput" 
            placeholder="Tape ta r√©ponse ici..."
            onkeypress="if(event.key==='Enter') proposerReponse()"
          />
          <button class="btn-success" onclick="proposerReponse()">‚úì Valider</button>
        </div>
      </div>

      <div class="players-area">
        <h3>üë• Joueurs</h3>
        <div id="playersList"></div>
      </div>

      <div class="chat-area" id="chatArea"></div>
    </div>

    <!-- √âcran de r√©sultat -->
    <div id="resultScreen" class="hidden resultat">
      <h2>üèÜ Partie termin√©e !</h2>
      <p style="font-size: 1.3rem; margin: 20px 0;">La r√©ponse √©tait : <strong id="correctAnswer"></strong></p>
      
      <div class="podium" id="podium"></div>
      
      <button class="btn-primary" onclick="nouvellePartie()">üîÑ Nouvelle partie</button>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let myPseudo = null;
let timerInterval = null;
let startTime = null;

// Demander le pseudo
function askPseudo() {
  if (myPseudo) return;
  myPseudo = prompt("Choisis un pseudo :");
  if (!myPseudo) myPseudo = 'Joueur' + Math.floor(Math.random() * 1000);
  socket.emit('joinGame', 'kukipix'); // Rejoindre le room Kukipix
  socket.emit('rejoindreSalonKukipix', myPseudo);
}
setTimeout(askPseudo, 200);

// D√©marrer une partie
function demarrerPartie() {
  socket.emit('demarrerPartie');
}

// Proposer une r√©ponse
function proposerReponse() {
  const input = document.getElementById('answerInput');
  const reponse = input.value.trim();
  if (reponse) {
    socket.emit('proposerReponse', reponse);
    input.value = '';
  }
}

// Nouvelle partie
function nouvellePartie() {
  socket.emit('demarrerPartie');
}

// Formater le temps
function formatTime(ms) {
  const seconds = Math.floor(ms / 1000);
  const minutes = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

// D√©marrer le timer
function startTimer() {
  startTime = Date.now();
  if (timerInterval) clearInterval(timerInterval);
  
  timerInterval = setInterval(() => {
    const elapsed = Date.now() - startTime;
    document.getElementById('timer').textContent = formatTime(elapsed);
  }, 100);
}

// Arr√™ter le timer
function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

// Socket events
socket.on('nouvellePartie', data => {
  console.log('üéÆ Nouvelle partie');
  document.getElementById('waitingScreen').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');
  document.getElementById('resultScreen').classList.add('hidden');
  document.getElementById('gameImage').src = '';
  document.getElementById('answerInput').value = '';
  document.getElementById('imageInfo').textContent = 'Image pixelis√©e (18px)';
  startTimer();
});

socket.on('imageUpdate', data => {
  console.log('üñºÔ∏è Image re√ßue:', data.size);
  document.getElementById('gameImage').src = data.image;
  document.getElementById('imageInfo').textContent = `R√©solution : ${data.size}`;
});

socket.on('etatSalon', salon => {
  const playersList = document.getElementById('playersList');
  playersList.innerHTML = '';
  
  Object.values(salon.joueurs || {}).forEach(j => {
    const item = document.createElement('div');
    item.className = 'player-item';
    item.innerHTML = `
      <span class="player-name">${j.pseudo}</span>
      <span class="player-points">${j.points} pts</span>
      ${j.aTrouve ? '<span class="player-found">‚úì</span>' : ''}
    `;
    playersList.appendChild(item);
  });
});

socket.on('chatMessage', msg => {
  const chatArea = document.getElementById('chatArea');
  const div = document.createElement('div');
  div.className = 'chat-message';
  div.textContent = msg;
  chatArea.appendChild(div);
  chatArea.scrollTop = chatArea.scrollHeight;
});

socket.on('finPartie', data => {
  console.log('üèÅ Fin de partie');
  stopTimer();
  
  document.getElementById('gameScreen').classList.add('hidden');
  document.getElementById('resultScreen').classList.remove('hidden');
  document.getElementById('correctAnswer').textContent = data.reponse;
  
  const podium = document.getElementById('podium');
  podium.innerHTML = '';
  
  data.classement.forEach((joueur, index) => {
    const item = document.createElement('div');
    item.className = 'podium-item';
    if (index === 0) item.classList.add('first');
    else if (index === 1) item.classList.add('second');
    else if (index === 2) item.classList.add('third');
    
    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
    
    item.innerHTML = `
      <span>${medal} ${joueur.pseudo}</span>
      <span style="font-weight: bold;">${joueur.points} pts</span>
    `;
    podium.appendChild(item);
  });
});

console.log('‚úÖ Client Kukipix charg√©');
</script>
</body>
</html>