<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>BMC - Mobile</title>

<style>

/* ------------------ REGLAGE POUR IGNORER LA BARRE DU NAVIGATEUR ------------------ */
:root {
    --vh: 1vh;
}

body, html {
    margin: 0;
    padding: 0;
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
    height: calc(var(--vh) * 100);
    overflow: hidden;
}

/* ------------------ CONTENEUR PRINCIPAL ------------------ */
#app {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: calc(var(--vh) * 100);
    box-sizing: border-box;
}

/* ------------------ QUESTION ------------------ */
#questionCard {
    background: white;
    color: black;
    padding: 15px;
    margin: 8px auto;
    width: 92%;
    border-radius: 12px;
    font-size: 1.1em;
    text-align: center;
}

/* ------------------ CARTES POSEES ------------------ */
#zonePosee {
    flex: 1;
    width: 100%;
    padding: 8px;
    overflow-x: auto;
    display: flex;
    gap: 8px;
    align-items: center;
    scroll-snap-type: x mandatory;
}

.cartePosee {
    min-width: 160px;
    background: #fff;
    color: #000;
    padding: 12px;
    border-radius: 10px;
    scroll-snap-align: center;
    font-size: 0.95em;
}

/* ------------------ MAIN DU JOUEUR ------------------ */
#maMain {
    height: 150px;
    overflow-x: auto;
    display: flex;
    gap: 10px;
    padding: 10px;
    background: #222;
    scroll-snap-type: x mandatory;
    border-top: 2px solid #333;
}

.carteMain {
    min-width: 140px;
    background: #fff;
    color: #000;
    padding: 12px;
    border-radius: 10px;
    scroll-snap-align: start;
    font-size: 0.95em;
    flex-shrink: 0;
}

/* ------------------ BOUTONS FLOTTANTS ------------------ */
#btnChangerQuestion, #btnChangerMain {
    position: fixed;
    right: 10px;
    background: #ffcc00;
    color: black;
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: bold;
    z-index: 10;
}

#btnChangerQuestion { top: 10px; }
#btnChangerMain { top: 55px; }

/* ------------------ CHAT FLOTTANT ------------------ */

#chatIcon {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 55px;
    height: 55px;
    background: #0af;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    z-index: 50;
}

#chatBox {
    position: fixed;
    bottom: 80px;
    left: 10px;
    width: 90%;
    height: 40%;
    background: rgba(0,0,0,0.9);
    border: 2px solid #0af;
    border-radius: 12px;
    display: none;
    flex-direction: column;
    z-index: 100;
}

#messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
}

#chatInput {
    width: 100%;
    padding: 8px;
    border: none;
    outline: none;
}

</style>
</head>

<body>

<div id="app">

    <div id="questionCard">Chargement question...</div>

    <div id="zonePosee"></div>

    <div id="maMain"></div>

</div>

<button id="btnChangerQuestion">Changer carte</button>
<button id="btnChangerMain">Changer main</button>

<div id="chatIcon">ðŸ’¬</div>

<div id="chatBox">
    <div id="messages"></div>
    <input id="chatInput" type="text" placeholder="Message..." />
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

/* ------------------ FIX 100VH MOBILE ------------------ */
function updateVH() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
updateVH();
window.addEventListener("resize", updateVH);
window.addEventListener("orientationchange", updateVH);

/* ------------------ PSEUDO AUTOMATIQUE ------------------ */
let pseudo = "";
while (!pseudo) pseudo = prompt("Votre pseudo :");
socket.emit("rejoindreSalon", pseudo);

/* ------------------ CARTES ------------------ */
const maMain = document.getElementById("maMain");
const zonePosee = document.getElementById("zonePosee");
const questionCard = document.getElementById("questionCard");

socket.on("main", cards => {
    maMain.innerHTML = "";
    cards.forEach((txt, i) => {
        const c = document.createElement("div");
        c.className = "carteMain";
        c.textContent = txt;

        c.onclick = () => {
            socket.emit("poserCarteIndex", i);
        };
        maMain.appendChild(c);
    });
});

socket.on("cartesPosees", cartes => {
    zonePosee.innerHTML = "";
    cartes.forEach((c, i) => {
        const div = document.createElement("div");
        div.className = "cartePosee";
        div.textContent = c.carte;
        div.onclick = () => socket.emit("voter", i);
        zonePosee.appendChild(div);
    });
});

/* question */
socket.on("question", q => {
    questionCard.textContent = q;
});

/* ------------------ CHANGER QUESTION ------------------ */
document.getElementById("btnChangerQuestion").onclick = () => {
    socket.emit("changerQuestion");
};

/* ------------------ CHANGER MAIN ------------------ */
document.getElementById("btnChangerMain").onclick = () => {
    socket.emit("changerMain");
};

/* ------------------ CHAT ------------------ */
const chatIcon = document.getElementById("chatIcon");
const chatBox = document.getElementById("chatBox");
const messages = document.getElementById("messages");
const chatInput = document.getElementById("chatInput");

chatIcon.onclick = () => {
    chatBox.style.display = chatBox.style.display === "flex" ? "none" : "flex";
};

chatInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && chatInput.value.trim() !== "") {
        socket.emit("chatMessage", chatInput.value.trim());
        chatInput.value = "";
    }
});

socket.on("chatMessage", msg => {
    const div = document.createElement("div");
    div.textContent = msg;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
});

</script>
</body>
</html>
