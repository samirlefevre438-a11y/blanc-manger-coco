<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Blanc Mangé Coco - Mobile</title>

<!-- POLICE TFMadLoud -->
<style>
@font-face {
  font-family: "TFMadloud";
  src: url("fonts/TF-Madloud.ttf") format("truetype");
}
</style>

<style>
/* GLOBAL */
body {
  background: #031d11;
  color: #0DFF8A;
  margin: 0;
  font-family: "TFMadloud", sans-serif;
  overflow-x: hidden;
}

/* TITRE */
#titreJeu {
  text-align: center;
  font-size: 1.7em;
  margin: 15px 0;
}

/* CARTE QUESTION */
#carteQuestion {
  background: white;
  color: black;
  padding: 15px;
  border-radius: 12px;
  width: 85%;
  margin: 10px auto;
  font-size: 1.1em;
  font-family: Arial, sans-serif;
  text-align: center;
}

/* CARTES POSÉES */
#cartesPosees {
  display: flex;
  overflow-x: auto;
  gap: 10px;
  padding: 10px;
  margin-top: 10px;
}

.cartePosee {
  background: white;
  color: black;
  min-width: 130px;
  max-width: 130px;
  padding: 12px;
  border-radius: 10px;
  font-family: Arial, sans-serif;
  font-size: 0.95em;
}

/* MAIN */
#main {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  padding: 10px;
}

.mainCarte {
  background: white;
  color: black;
  min-width: 140px;
  max-width: 140px;
  padding: 14px;
  border-radius: 12px;
  font-family: Arial, sans-serif;
  font-size: 1em;
  cursor: pointer;
}

/* BARRE D’OPTIONS */
#bottomBar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #062b1a;
  padding: 10px;
  display: flex;
  justify-content: space-around;
  border-top: 3px solid #0DFF8A;
}

/* BOUTONS */
.btn {
  background: #0DFF8A;
  color: #031d11;
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  font-family: "TFMadloud";
  font-size: 1.1em;
}

.btn:active {
  background: #0bdf76;
}

/* ICON CHAT FLOATING */
#chatIcon {
  position: fixed;
  bottom: 85px;
  right: 20px;
  background: #0DFF8A;
  color: #031d11;
  width: 55px;
  height: 55px;
  border-radius: 50%;
  font-size: 1.6em;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "TFMadloud";
  cursor: pointer;
}

/* CHAT PANEL */
#chatPanel {
  position: fixed;
  bottom: 0;
  right: 0;
  width: 85%;
  height: 65%;
  background: #062b1a;
  border-left: 3px solid #0DFF8A;
  border-top: 3px solid #0DFF8A;
  transform: translateY(110%);
  transition: 0.4s ease;
  display: flex;
  flex-direction: column;
}

#chatPanel.active {
  transform: translateY(0%);
}

#chatMessages {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

#chatInput {
  width: 90%;
  margin: 10px auto;
  padding: 8px;
}

/* VOTE OVERLAY */
#voteZone {
  text-align: center;
  background: #041f12;
  padding: 10px;
  border-bottom: 2px solid #0DFF8A;
  display: none;
}
</style>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let pseudo = "";

/* DEMANDE PSEUDO */
window.onload = () => {
  pseudo = prompt("Entrez votre pseudo :");
  socket.emit("rejoindreSalon", pseudo);
};

/* ——— MISE À JOUR QUESTION ——— */
socket.on("question", (q) => {
  document.getElementById("carteQuestion").innerText = q;
});

/* ——— MISE À JOUR MAIN ——— */
socket.on("main", (main) => {
  const div = document.getElementById("main");
  div.innerHTML = "";
  main.forEach((c, index) => {
    const el = document.createElement("div");
    el.className = "mainCarte";
    el.innerText = c;
    el.onclick = () => socket.emit("poserCarteIndex", index);
    div.appendChild(el);
  });
});

/* ——— CARTES POSÉES ——— */
socket.on("cartesPosees", (cartes) => {
  const zone = document.getElementById("cartesPosees");
  zone.innerHTML = "";
  cartes.forEach((c) => {
    const el = document.createElement("div");
    el.className = "cartePosee";
    el.innerText = c.carte;
    zone.appendChild(el);
  });
});

/* ——— ZONE DE VOTE ——— */
socket.on("phaseVote", (cartes) => {
  const zone = document.getElementById("voteZone");
  zone.innerHTML = "<h3>Vote :</h3>";

  cartes.forEach((c, i) => {
    let el = document.createElement("div");
    el.className = "cartePosee";
    el.style.margin = "10px auto";
    el.innerText = c;
    el.onclick = () => socket.emit("voter", i);
    zone.appendChild(el);
  });

  zone.style.display = "block";
});

/* ——— FIN VOTE : NOUVEAU TOUR ——— */
socket.on("nouveauTour", () => {
  document.getElementById("voteZone").style.display = "none";
  document.getElementById("cartesPosees").innerHTML = "";
});

/* ——— CHAT ——— */
socket.on("chatMessage", (msg) => {
  let box = document.getElementById("chatMessages");
  box.innerHTML += `<div>${msg}</div>`;
  box.scrollTop = box.scrollHeight;
});
</script>
</head>

<body>

<h2 id="titreJeu">Blanc Mangé Coco</h2>

<div id="carteQuestion">Chargement...</div>

<!-- CARTES POSÉES -->
<div id="cartesPosees"></div>

<!-- ZONE DE VOTE -->
<div id="voteZone"></div>

<!-- MAIN -->
<h3 style="text-align:center;">Votre main</h3>
<div id="main"></div>

<!-- CHAT ICON -->
<div id="chatIcon" onclick="toggleChat()">✉</div>

<!-- CHAT PANEL -->
<div id="chatPanel" id="chatWindow">
  <div id="chatMessages"></div>
  <input id="chatInput" placeholder="Message..." 
         onkeypress="if(event.key==='Enter'){ socket.emit('chatMessage', this.value); this.value=''; }">
</div>

<script>
function toggleChat() {
  document.getElementById("chatPanel").classList.toggle("active");
}
</script>

<!-- BOTTOM BAR -->
<div id="bottomBar">
  <button class="btn" onclick="socket.emit('changerMain')">Changer main</button>
  <button class="btn" onclick="socket.emit('changerQuestion')">Changer carte</button>
</div>

</body>
</html>
