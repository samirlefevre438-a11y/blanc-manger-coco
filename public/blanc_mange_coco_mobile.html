<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>Blanc Mang√© Coco ‚Ä¢ Mobile</title>

<style>
/* ------------------------------------------------ */
/* -------------------- VARIABLES ------------------ */
/* ------------------------------------------------ */
:root {
  --vert: #0DFF8A;
  --fond: #0A0A0A;
  --fond2: #111;
  --carteW: 150px;
  --carteH: 210px;
}

/* ------------------------------------------------ */
/* ------------------- GLOBAL ---------------------- */
/* ------------------------------------------------ */
body {
  margin: 0;
  padding: 0;
  background: var(--fond);
  font-family: "Madloud", Arial, sans-serif;
  color: white;
  overflow: hidden;
}

/* Police MADLOUD (interface uniquement) */
@font-face {
  font-family: "Madloud";
  src: url("madloud.ttf");
}

/* ------------------------------------------------ */
/* -------------- ZONE QUESTION -------------------- */
/* ------------------------------------------------ */
#questionBox {
  width: 100%;
  text-align: center;
  padding: 10px;
  font-size: 1.2rem;
  background: var(--fond2);
  border-bottom: 2px solid var(--vert);
  height: 70px;
  box-sizing: border-box;
}

/* ------------------------------------------------ */
/* -------------- CARTES POS√âES -------------------- */
/* ------------------------------------------------ */
#cartesPosees {
  position: absolute;
  top: 70px;
  bottom: 140px;
  left: 0;
  right: 0;
  overflow-x: auto;
  white-space: nowrap;
  padding: 10px;
  display: flex;
  gap: 12px;
}

.cartePosee {
  width: var(--carteW);
  height: var(--carteH);
  background-image: url("carte.png");
  background-size: 100% 100%;
  border-radius: 12px;
  display: inline-block;
  position: relative;            /* ‚Üê IMPORTANT */
}
.carteTexte {
  position: absolute;
  top: 8px;
  left: 6px;
  right: 6px;
  color: black;
  font-size: 0.9rem;
  font-family: Arial, sans-serif;
  z-index: 10;                   /* ‚Üê RAJOUT */
  pointer-events: none;
}


/* ------------------------------------------------ */
/* ---------------- MAIN DU JOUEUR ---------------- */
/* ------------------------------------------------ */

#mainJoueur {
  position: absolute;
  bottom: 50px;
  left: 0;
  right: 0;
  height: 160px;
  overflow-x: auto;
  white-space: nowrap;
  display: flex;
  gap: 12px;
  padding: 10px;
}

.carteMain {
  width: calc(var(--carteW) * 0.9);
  height: calc(var(--carteH) * 0.9);
  background-image: url("carte.png");
  background-size: 100% 100%;
  border-radius: 10px;
  position: relative;
  display: inline-block;
}

.carteMainTexte {
  position: absolute;
  top: 6px;
  left: 5px;
  right: 5px;
  font-size: 0.85rem;
  color: black;
  font-family: Arial, sans-serif;
}

/* ------------------------------------------------ */
/* ------------------- CHAT ------------------------ */
/* ------------------------------------------------ */

#chatBtn {
  position: absolute;
  bottom: 55px;
  right: 15px;
  width: 55px;
  height: 55px;
  background: var(--vert);
  color: black;
  border-radius: 50%;
  text-align: center;
  line-height: 55px;
  font-size: 28px;
  z-index: 1200;
  box-shadow: 0 0 10px var(--vert);
}

#chatWindow {
  position: absolute;
  bottom: 125px;
  right: 10px;
  width: 260px;
  height: 300px;
  background: var(--fond2);
  border: 2px solid var(--vert);
  border-radius: 10px;
  display: none;
  flex-direction: column;
  overflow: hidden;
  z-index: 1500;
}

#chatMessages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
  font-size: 0.9rem;
}

#chatInput {
  width: 100%;
  height: 35px;
  border: none;
  outline: none;
  padding-left: 8px;
  font-size: 0.9rem;
}

/* ------------------------------------------------ */
/* ---------------- PARAM√àTRES --------------------- */
/* ------------------------------------------------ */

#paramBtn {
  position: absolute;
  bottom: 55px;
  left: 15px;
  width: 55px;
  height: 55px;
  background: var(--vert);
  color: black;
  border-radius: 50%;
  text-align: center;
  line-height: 55px;
  font-size: 28px;
  z-index: 1200;
  box-shadow: 0 0 10px var(--vert);
}

#paramWindow {
  position: absolute;
  bottom: 125px;
  left: 10px;
  width: 260px;
  background: var(--fond2);
  border: 2px solid var(--vert);
  border-radius: 10px;
  padding: 10px;
  display: none;
  z-index: 1500;
}

.paramBtn {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  background: var(--vert);
  color: black;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
}

/* ------------------------------------------------ */
/* -------- BARRE DES JOUEURS EN BAS -------------- */
/* ------------------------------------------------ */

#joueursBar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 50px;
  background: rgba(0,0,0,0.85);
  border-top: 2px solid var(--vert);
  display: flex;
  gap: 10px;
  overflow-x: auto;
  align-items: center;
  padding: 5px 10px;
  box-sizing: border-box;
  font-size: 0.9rem;
}

.joueurItem {
  background: var(--fond2);
  border: 1px solid var(--vert);
  color: var(--vert);
  padding: 5px 10px;
  border-radius: 10px;
  white-space: nowrap;
  font-family: Arial, sans-serif;
}
</style>
</head>

<body>

<div id="questionBox">Chargement...</div>
<div id="cartesPosees"></div>
<div id="mainJoueur"></div>

<!-- CHAT -->
<div id="chatBtn">üí¨</div>
<div id="chatWindow">
  <div id="chatMessages"></div>
  <input id="chatInput" placeholder="Message..." />
</div>

<!-- PARAMETRES -->
<div id="paramBtn">‚öô</div>
<div id="paramWindow">
  <button class="paramBtn" id="btnChangerQuestion">Changer la carte</button>
  <button class="paramBtn" id="btnChangerMain">Changer de main</button>
  <button class="paramBtn" id="btnQuitter">Quitter</button>
</div>

<!-- JOUEURS EN BAS -->
<div id="joueursBar"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

/* Elements DOM */
const questionBox = document.getElementById("questionBox");
const cartesPosees = document.getElementById("cartesPosees");
const mainJoueur = document.getElementById("mainJoueur");

const chatBtn = document.getElementById("chatBtn");
const chatWindow = document.getElementById("chatWindow");
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");

const paramBtn = document.getElementById("paramBtn");
const paramWindow = document.getElementById("paramWindow");

const joueursBar = document.getElementById("joueursBar");

/* ------------------------------------------------ */
/* -------------- INTERFACE ELEMENTAIRE ----------- */
/* ------------------------------------------------ */
chatBtn.onclick = () => {
  chatWindow.style.display = chatWindow.style.display === "flex" ? "none" : "flex";
};

paramBtn.onclick = () => {
  paramWindow.style.display = paramWindow.style.display === "block" ? "none" : "block";
};

/* ------------------------------------------------ */
/* ---------------- CHAT -------------------------- */
/* ------------------------------------------------ */
chatInput.addEventListener("keydown", e => {
  if (e.key === "Enter" && chatInput.value.trim() !== "") {
    socket.emit("chatMessage", chatInput.value);
    chatInput.value = "";
  }
});

socket.on("chatMessage", msg => {
  const div = document.createElement("div");
  div.textContent = msg;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
});

/* ------------------------------------------------ */
/* ------------------- JEU ------------------------ */
/* ------------------------------------------------ */

socket.on("question", txt => {
  questionBox.textContent = txt;
});

socket.on("main", cartes => {
  mainJoueur.innerHTML = "";
  cartes.forEach((texte, index) => {
    const c = document.createElement("div");
    c.className = "carteMain";
    c.onclick = () => socket.emit("poserCarteIndex", index);

    const t = document.createElement("div");
    t.className = "carteMainTexte";
    t.textContent = texte;

    c.appendChild(t);
    mainJoueur.appendChild(c);
  });
});

socket.on("cartesPosees", cartes => {
  cartesPosees.innerHTML = "";
  cartes.forEach(carte => {
    const c = document.createElement("div");
    c.className = "cartePosee";

    const t = document.createElement("div");
    t.className = "carteTexte";
    t.textContent = carte.carte;

    c.appendChild(t);
    cartesPosees.appendChild(c);
  });
});

/* Vote */
socket.on("phaseVote", cartes => {
  cartesPosees.innerHTML = "";
  cartes.forEach((texte, index) => {
    const c = document.createElement("div");
    c.className = "cartePosee";
    c.onclick = () => socket.emit("voter", index);

    const t = document.createElement("div");
    t.className = "carteTexte";
    t.textContent = texte;

    c.appendChild(t);
    cartesPosees.appendChild(c);
  });
});

/* ------------------------------------------------ */
/* -------------- PARAMETRES ---------------------- */
/* ------------------------------------------------ */

document.getElementById("btnChangerQuestion").onclick = () => {
  socket.emit("changerQuestion");
};

document.getElementById("btnChangerMain").onclick = () => {
  socket.emit("changerMain");
};

document.getElementById("btnQuitter").onclick = () => {
  socket.emit("deconnexion");
  window.location.href = "index.html";
};

/* ------------------------------------------------ */
/* ------------ JOUEURS + POINTS ------------------ */
/* ------------------------------------------------ */

socket.on("etatSalon", salon => {
  joueursBar.innerHTML = "";
  Object.values(salon.joueurs).forEach(j => {
    const div = document.createElement("div");
    div.className = "joueurItem";
    div.textContent = `${j.pseudo} : ${j.points}`;
    joueursBar.appendChild(div);
  });
});

/* Rejoindre */
setTimeout(() => {
  const pseudo = prompt("Choisis un pseudo :");
  if (pseudo) socket.emit("rejoindreSalon", pseudo);
}, 300);

</script>
</body>
</html>
