<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blanc MangÃ© Coco - Mobile</title>
<style>
body {
  margin: 0;
  background: #fafafa;
  font-family: 'Poppins', sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}
header {
  background: #333;
  color: white;
  text-align: center;
  padding: 8px;
  font-size: 1em;
  position: relative;
}
#btnChangerMain {
  position: absolute;
  right: 10px;
  top: 6px;
  background: #ff9800;
  border: none;
  color: white;
  border-radius: 8px;
  padding: 5px 10px;
  font-size: 0.9em;
  cursor: pointer;
}
#btnChangerQuestion {
  position: absolute;
  left: 10px;
  top: 6px;
  background: #4caf50;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 5px 10px;
  font-size: 0.9em;
  cursor: pointer;
}
#question {
  text-align: center;
  background: #fefefe;
  border: 2px solid #333;
  border-radius: 10px;
  margin: 8px auto;
  padding: 8px;
  width: 90%;
  font-size: 0.95em;
}
/* Cartes posÃ©es */
#zoneCartesPosees {
  flex: 1;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: flex-start;
  flex-wrap: nowrap;
  overflow-x: auto;
  padding: 10px;
  gap: 10px;
  scroll-snap-type: x mandatory;
}
.cartePosee {
  background: white;
  border-radius: 8px;
  padding: 6px;
  width: 80px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  flex-shrink: 0;
  scroll-snap-align: center;
  transition: transform 0.3s, opacity 0.3s;
  font-size: 0.75em;
  opacity: 0;
  transform: translateY(20px);
  animation: slideIn 0.4s ease-out forwards;
}
.cartePosee.votable {
  cursor: pointer;
  border: 2px solid transparent;
}
.cartePosee.votable:active {
  transform: scale(0.95);
  border-color: #007bff;
}
@keyframes slideIn {
  to { opacity:1; transform:translateY(0); }
}
/* Main joueur */
#main {
  display: flex;
  overflow-x: auto;
  gap: 8px;
  padding: 8px;
  background: #fff;
  border-top: 1px solid #ddd;
  scroll-snap-type: x mandatory;
}
.carte {
  background: white;
  border-radius: 10px;
  padding: 8px;
  min-width: 95px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  flex-shrink: 0;
  scroll-snap-align: center;
  cursor: pointer;
  transition: transform 0.15s;
  font-size: 0.85em;
}
.carte:active { transform: scale(0.9); }
/* Animation gagnant */
#winnerAnimation {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: gold;
  color: #333;
  font-weight: bold;
  padding: 20px 40px;
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(255,215,0,0.7);
  display: none;
  animation: pop 1s ease-out;
  z-index: 20;
}
@keyframes pop {
  0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
  50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1); }
}
/* Chat flottant */
#chatIcon {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #007bff;
  color: white;
  font-size: 1.4em;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  cursor: pointer;
  z-index: 10;
}
#chatBox {
  position: fixed;
  bottom: 75px;
  right: 10px;
  width: 80%;
  max-width: 300px;
  height: 45%;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  display: none;
  flex-direction: column;
  overflow: hidden;
  animation: slideUp 0.3s ease-out;
  z-index: 9;
}
@keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
#chatMessages { flex: 1; overflow-y: auto; padding: 8px; font-size: 0.9em; }
#chatInput { border: none; border-top: 1px solid #ddd; padding: 8px; font-size: 1em; width: 100%; outline: none; }
/* Pseudo modal */
#pseudoModal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
}
#pseudoModal div { background: white; padding: 20px; border-radius: 12px; text-align:center; }
#pseudoModal input { padding:10px; font-size:1em; width:80%; margin-top:10px; }
#pseudoModal button { margin-top:10px; padding:10px 20px; border:none; background:#007bff; color:white; border-radius:8px; font-size:1em; }
</style>
</head>
<body>

<header>
  Blanc MangÃ© Coco ðŸ“±
  <button id="btnChangerMain" onclick="changerMain()">ðŸ”„ Main</button>
  <button id="btnChangerQuestion" onclick="changerQuestion()">ðŸ”„ Question</button>
</header>

<div id="question">Chargement de la question...</div>

<div id="zoneCartesPosees"></div>

<div id="main"></div>

<div id="chatIcon">ðŸ’¬</div>

<div id="chatBox">
  <div id="chatMessages"></div>
  <input id="chatInput" placeholder="Ã‰crire un message..." />
</div>

<div id="winnerAnimation"></div>

<div id="pseudoModal">
  <div>
    <h3>Entre ton pseudo</h3>
    <input id="pseudoInput" placeholder="Pseudo..." />
    <button onclick="validerPseudo()">OK</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let pseudo = null;

function validerPseudo() {
  const input = document.getElementById("pseudoInput");
  if (!input.value.trim()) return;
  pseudo = input.value.trim();
  socket.emit("rejoindreSalon", pseudo);
  document.getElementById("pseudoModal").style.display = "none";
}

// --- Main joueur ---
socket.on("main", cartes => {
  const zone = document.getElementById("main");
  zone.innerHTML = "";
  cartes.forEach((c,i) => {
    const div = document.createElement("div");
    div.className="carte";
    div.textContent=c;
    div.onclick = ()=>socket.emit("poserCarteIndex",i);
    zone.appendChild(div);
  });
});

// --- Question ---
socket.on("question", q => document.getElementById("question").textContent = q);

// --- Cartes posÃ©es ---
socket.on("cartesPosees", cartes => {
  const zone = document.getElementById("zoneCartesPosees");
  zone.innerHTML="";
  cartes.forEach(c=>{
    const div = document.createElement("div");
    div.className="cartePosee";
    div.textContent=c.carte;
    zone.appendChild(div);
  });
});

// --- Phase vote ---
socket.on("phaseVote", cartes=>{
  const zone = document.getElementById("zoneCartesPosees");
  zone.innerHTML="";
  cartes.forEach((texte,i)=>{
    const div = document.createElement("div");
    div.className="cartePosee votable";
    div.textContent = texte;
    div.onclick = ()=>socket.emit("voter", i);
    zone.appendChild(div);
  });
});

// --- Nouveau tour / animation gagnant ---
socket.on("nouveauTour", data=>{
  const { gagnants } = data;
  if (gagnants && gagnants.length>0){
    const winnerDiv = document.getElementById("winnerAnimation");
    winnerDiv.textContent = gagnants.length===1 ? "ðŸ† Manche gagnÃ©e !" : "ðŸ¤ Ã‰galitÃ© !";
    winnerDiv.style.display="block";
    setTimeout(()=>winnerDiv.style.display="none", 2500);
  }
  document.getElementById("zoneCartesPosees").innerHTML="";
});

// --- Changer sa main ---
function changerMain(){ socket.emit("changerMain"); }

// --- Changer question ---
function changerQuestion(){ socket.emit("changerQuestion"); }

// --- Chat ---
const chatIcon = document.getElementById("chatIcon");
const chatBox = document.getElementById("chatBox");
chatIcon.onclick = ()=>chatBox.style.display = chatBox.style.display==="none"?"flex":"none";

const chatInput = document.getElementById("chatInput");
chatInput.addEventListener("keypress", e=>{
  if(e.key==="Enter" && chatInput.value.trim()!==""){
    socket.emit("chatMessage", chatInput.value.trim());
    chatInput.value="";
  }
});
socket.on("chatMessage", msg=>{
  const chat=document.getElementById("chatMessages");
  const div=document.createElement("div");
  div.textContent=msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
});
</script>
</body>
</html>
