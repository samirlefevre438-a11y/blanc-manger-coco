<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Blanc Mang√© Coco - Mobile</title>

<style>
:root {
  --vh: 1vh;
}

body, html {
  margin: 0;
  padding: 0;
  height: calc(var(--vh) * 100);
  font-family: Arial, sans-serif;
  background: #111;
  color: white;
  overflow: hidden;
}

/* ------------------ CONTENEUR PRINCIPAL ------------------ */
#app {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: calc(var(--vh) * 100);
  box-sizing: border-box;
}

/* ------------------ QUESTION ------------------ */
#questionCard {
  background: #fff;
  color: #000;
  padding: 15px;
  margin: 8px auto;
  width: 92%;
  border-radius: 12px;
  font-size: 1.1em;
  text-align: center;
  flex-shrink: 0;
}

/* ------------------ CARTES POSEES ------------------ */
#zonePosee {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  gap: 8px;
  padding: 8px;
  justify-content: flex-start;
  flex-shrink: 0;
}

.cartePosee {
  min-width: 120px;
  max-width: 140px;
  background: #fff;
  color: #000;
  padding: 8px;
  border-radius: 10px;
  scroll-snap-align: start;
  font-size: 13px;
  flex-shrink: 0;
}

/* ------------------ MAIN DU JOUEUR ------------------ */
#maMain {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  gap: 8px;
  padding: 10px;
  background: #222;
  border-top: 2px solid #333;
  flex-shrink: 0;
}

.carteMain {
  min-width: 120px;
  max-width: 140px;
  padding: 10px;
  background: #fff;
  color: #000;
  border-radius: 10px;
  scroll-snap-align: start;
  font-size: 13px;
  flex-shrink: 0;
}

/* ------------------ MENU OPTIONS ------------------ */
#menuOptionsBtn {
  position: fixed;
  top: 12px;
  right: 12px;
  width: 45px;
  height: 45px;
  background: #333;
  color: white;
  font-size: 28px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  border: none;
  z-index: 9999;
}

#menuOptions {
  position: fixed;
  top: 60px;
  right: 10px;
  background: white;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  z-index: 9999;
  display: none;
  width: 180px;
}

#menuOptions button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  background: #444;
  color: white;
  font-size: 15px;
}

/* ------------------ CHAT ------------------ */
#chatIcon {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 55px;
  height: 55px;
  background: #0af;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  z-index: 50;
}

#chatBox {
  position: fixed;
  bottom: 80px;
  left: 10px;
  width: 90%;
  height: 40%;
  background: rgba(0,0,0,0.9);
  border: 2px solid #0af;
  border-radius: 12px;
  display: none;
  flex-direction: column;
  z-index: 100;
}

#messages {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

#chatInput {
  width: 100%;
  padding: 8px;
  border: none;
  outline: none;
  font-size: 14px;
  box-sizing: border-box;
}
</style>
</head>

<body>
<div id="app">
  <div id="questionCard">Chargement question...</div>
  <div id="zonePosee"></div>
  <div id="maMain"></div>
</div>

<!-- MENU OPTIONS -->
<button id="menuOptionsBtn">‚öôÔ∏è</button>
<div id="menuOptions">
  <button id="changerCarteBtn">Changer carte</button>
  <button id="changerMainBtn">Changer main</button>
  <button onclick="fermerMenu()">Fermer</button>
</div>

<!-- CHAT -->
<div id="chatIcon">üí¨</div>
<div id="chatBox">
  <div id="messages"></div>
  <input id="chatInput" type="text" placeholder="Message..." />
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

/* ------------------ FIX 100VH MOBILE ------------------ */
function updateVH() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}
updateVH();
window.addEventListener("resize", updateVH);
window.addEventListener("orientationchange", updateVH);

/* ------------------ PSEUDO ------------------ */
let pseudo = "";
while(!pseudo) pseudo = prompt("Votre pseudo :");
socket.emit("rejoindreSalon", pseudo);

/* ------------------ MAIN DU JOUEUR ------------------ */
const maMain = document.getElementById("maMain");
socket.on("main", cards => {
    maMain.innerHTML = "";
    cards.forEach((txt,i)=>{
        const c = document.createElement("div");
        c.className = "carteMain";
        c.textContent = txt;
        c.onclick = ()=> socket.emit("poserCarteIndex", i);
        maMain.appendChild(c);
    });
    maMain.scrollLeft = 0;
});

/* ------------------ CARTES POSEES ------------------ */
const zonePosee = document.getElementById("zonePosee");
socket.on("cartesPosees", cartes => {
    zonePosee.innerHTML = "";
    cartes.forEach((c,i)=>{
        const div = document.createElement("div");
        div.className = "cartePosee";
        div.textContent = c.carte;
        div.onclick = ()=> socket.emit("voter", i);
        zonePosee.appendChild(div);
    });
    zonePosee.scrollLeft = 0;
});

/* ------------------ QUESTION ------------------ */
const questionCard = document.getElementById("questionCard");
socket.on("question", q=>{
    questionCard.textContent = q;
});

/* ------------------ MENU OPTIONS ------------------ */
const menuBtn = document.getElementById("menuOptionsBtn");
const menu = document.getElementById("menuOptions");

menuBtn.onclick = () => {
    menu.style.display = menu.style.display === "none" ? "flex" : "none";
};
function fermerMenu(){ menu.style.display = "none"; }

document.getElementById("changerCarteBtn").onclick = ()=>{
    socket.emit("changerCarte");
    fermerMenu();
};
document.getElementById("changerMainBtn").onclick = ()=>{
    socket.emit("changerMain");
    fermerMenu();
};

/* ------------------ CHAT ------------------ */
const chatIcon = document.getElementById("chatIcon");
const chatBox = document.getElementById("chatBox");
const messages = document.getElementById("messages");
const chatInput = document.getElementById("chatInput");

chatIcon.onclick = ()=>{
    chatBox.style.display = chatBox.style.display==="flex"?"none":"flex";
};

chatInput.addEventListener("keydown", e=>{
    if(e.key==="Enter" && chatInput.value.trim()!==""){
        socket.emit("chatMessage", chatInput.value.trim());
        chatInput.value="";
    }
});

socket.on("chatMessage", msg=>{
    const div = document.createElement("div");
    div.textContent = msg;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
});

/* ------------------ NOUVEAU TOUR ------------------ */
socket.on("nouveauTour", data=>{
    zonePosee.innerHTML = "";
    maMain.innerHTML = "";
    // redemande la main
    socket.emit("rejoindreSalon", pseudo);
});
</script>
</body>
</html>
